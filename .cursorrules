

## ğŸ“„ Product Requirements Document (PRD)

### ğŸ§° Product Name:
**IDOR-BAC Hunter**

---

### ğŸ¯ Objective:
Build a security testing tool that detects **Insecure Direct Object References (IDOR)** and **Broken Access Control (BAC)** vulnerabilities by analyzing and comparing endpoint responses using different user sessions, based on a crawled sitemap exported from **Burp Suite**.

---

### ğŸ§© Features & Functional Requirements

#### 1. **Input Module**
- ğŸ“‚ Accept a sitemap file exported from Burp Suite (e.g., `sitemap.txt`, `urls.json`, etc.).
- ğŸ§‘ Accept a `sessions.json` config file with multiple user credentials (cookie or auth token).
- ğŸ” Detect and handle cookie-based or token-based authentication.

##### Example `sessions.json`:
```json
{
  "admin": {
    "cookie": "sessionid=admin123"
  },
  "user1": {
    "cookie": "sessionid=user456"
  },
  "user2": {
    "token": "Bearer xyz789"
  }
}
```

---

#### 2. **Request Engine**
- ğŸŒ For each endpoint:
  - Send request using **user1**, **user2**, **admin** sessions.
- ğŸ§ª Test with methods: `GET`, `POST`, `PUT`, `DELETE` (based on endpoint).
- ğŸ›  Headers injected dynamically based on session config.

---

#### 3. **Response Analyzer**
- ğŸ§  Compare responses between users:
  - Status code differences
  - Body length & content hash
  - Key string matches like `"Access Denied"`, `"Unauthorized"`, `"admin"`, `"username"`, etc.
- âš  Flag suspicious differences:
  - Normal user getting admin data
  - User A seeing User B's content
  - Same response for everyone (no auth check)

---

#### 4. **Vulnerability Detector**
- âœ… Detects:
  - **IDOR**: Access to objects/resources that should be restricted.
  - **BAC**: Unrestricted access to protected endpoints.
- ğŸ” Compares responses to determine if access control is bypassed.

---

#### 5. **Smart ID Substitution (Advanced - Optional)**
- Automatically fuzz numeric or UUID values in URL paths or parameters.
- e.g., `/api/users/1001` â†’ try `1002`, `1003` for different users.

---

#### 6. **Output & Reporting**
- ğŸ“„ Generate a report (JSON & console):
  ```json
  {
    "endpoint": "/api/users/1001",
    "method": "GET",
    "vuln": "IDOR",
    "details": {
      "accessed_by": ["user2"],
      "status_code": 200,
      "diff": "user2 saw another user's info"
    }
  }
  ```
- Also log plain-text to `results.txt`.

---

### ğŸ–¥ Target Environment
- Platform: Python 3.x
- IDE: Cursor IDE (use GPT comments and docstrings for explainability)
- Dependencies:
  - `requests`
  - `tqdm`
  - `difflib` or `deepdiff` for response comparison
  - `argparse` for CLI usability

---

### ğŸ§ª Test Plan
- Use known vulnerable apps (like DVWA, BWAPP, Juice Shop).
- Manually validate a few IDORs to confirm tool flags them.
- Test edge cases (403 responses, redirects, JSON vs HTML formats).

---

### ğŸ§± MVP Breakdown

#### Week 1:
- Input parsing (sitemap + session file)
- Basic request engine
- Logging and CLI structure

#### Week 2:
- Response diffing logic
- IDOR & BAC detection
- Output report module

#### Week 3:
- Smart ID substitution
- Swagger/OpenAPI parser (if needed)
- UI or GUI layer (optional)



## ğŸ“ Folder Structure

```
idor-bac-hunter/
â”‚
â”œâ”€â”€ main.py                         # Entry point â€“ CLI handler and execution
â”œâ”€â”€ README.md                       # Project overview & usage instructions
â”œâ”€â”€ requirements.txt                # Dependencies list (requests, tqdm, etc.)
â”œâ”€â”€ config/
â”‚   â””â”€â”€ sessions.json               # Example user session config
â”‚
â”œâ”€â”€ input/
â”‚   â””â”€â”€ sitemap.txt                 # List of endpoints (from Burp Suite or custom)
â”‚
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ request_handler.py          # Handles sending requests with different sessions
â”‚   â”œâ”€â”€ session_loader.py           # Loads and formats session tokens/cookies
â”‚   â”œâ”€â”€ analyzer.py                 # Compares responses and detects anomalies
â”‚   â””â”€â”€ detector.py                 # Logic to determine IDOR/BAC issues
â”‚
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ logger.py                   # Logging and console output
â”‚   â”œâ”€â”€ helpers.py                  # Misc tools: URL parser, header builder, etc.
â”‚   â””â”€â”€ id_fuzzer.py                # (Optional) Smart ID substitution module
â”‚
â”œâ”€â”€ output/
â”‚   â”œâ”€â”€ results.json                # JSON report of all potential vulnerabilities
â”‚   â””â”€â”€ results.txt                 # Plain-text summary
â”‚
â””â”€â”€ tests/
    â”œâ”€â”€ test_endpoints.py          # Unit tests for parsing/handling endpoints
    â””â”€â”€ test_detector.py           # Tests for vulnerability detection logic
```

---

### âœ… Recommended First Files to Build

1. `main.py`: loads sitemap + sessions, triggers scan
2. `session_loader.py`: parses `sessions.json`
3. `request_handler.py`: sends requests with cookies/tokens
4. `analyzer.py`: compares results
5. `detector.py`: flags suspicious patterns
6. `logger.py`: print/save results
